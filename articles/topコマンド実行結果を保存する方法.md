---
title: "loadavgä¸Šæ˜‡æ™‚ã«ç¨¼åƒã—ã¦ã„ã‚‹ãƒ—ãƒ­ã‚»ã‚¹ã®ç¢ºèªæ–¹æ³•"
emoji: "ðŸ˜º"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Linux","ShellScript","bash"]
published: false
---
# ã¯ã˜ã‚ã«
ã‚µãƒ¼ãƒã§å®šæœŸçš„ã«ãƒ­ãƒ¼ãƒ‰ã‚¢ãƒ™ãƒ¬ãƒ¼ã‚¸ãŒä¸Šæ˜‡ã™ã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã—ãŸã€‚
ãã®åŽŸå› ã‚’æŽ¢ã‚‹ãŸã‚ã€ãƒ­ãƒ¼ãƒ‰ã‚¢ãƒ™ãƒ¬ãƒ¼ã‚¸ãŒä¸ŠãŒã£ãŸæ™‚ã®topã‚³ãƒžãƒ³ãƒ‰ã‹ã‚‰ç¨¼åƒã—ã¦ã„ã‚‹ãƒ—ãƒ­ã‚»ã‚¹ä¸€è¦§ã‚’å–å¾—ã™ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½œæˆã—ã¾ã—ãŸã€‚

# ã‚¹ã‚¯ãƒªãƒ—ãƒˆå…¨æ–‡
```
#!/bin/bash

#uptimeã‚³ãƒžãƒ³ãƒ‰ã‹ã‚‰Loadavgã‚’å–å¾—
loadavg=`uptime | awk '{print $8}' | sed -e 's/,$//'`

#topã‚³ãƒžãƒ³ãƒ‰å®Ÿè¡Œçµæžœã‚’ä¿å­˜ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å¤‰æ•°ã«ä»£å…¥
top_result=top_result-`date "+%Y%m%d"`.txt

#æ±ºã‚ãŸLoadavgã‚ˆã‚Šä¸Šæ˜‡ã—ãŸå ´åˆã«topã‚³ãƒžãƒ³ãƒ‰ã‚’å®Ÿè¡Œ
if [ `echo "$loadavg >= 4.00" | bc` -eq 1 ]; then
    for i in `seq 3`
    do
        echo -e "=======================================\n`date "+%Y%m%d%H%M"`" >> $top_result
        top -b -d 15 | head -15 >> $top_result
    done
fi
```